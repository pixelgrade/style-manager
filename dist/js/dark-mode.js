/*! For license information please see dark-mode.js.LICENSE.txt */
(function(){"use strict";var __webpack_modules__={"./src/_js/dark-mode/index.js":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ \"jquery\");\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\n\nvar COLOR_SCHEME_BUTTON_SELECTOR = '.js-sm-dark-mode-toggle';\nvar STORAGE_ITEM = 'color-scheme-dark';\nvar TEMP_STORAGE_ITEM = 'color-scheme-dark-temp';\n\nvar DarkMode = /*#__PURE__*/function () {\n  function DarkMode() {\n    _classCallCheck(this, DarkMode);\n\n    this.initialize();\n  }\n\n  _createClass(DarkMode, [{\n    key: \"initialize\",\n    value: function initialize() {\n      var _window$document$docu,\n          _this = this;\n\n      this.darkModeSetting = (_window$document$docu = window.document.documentElement.dataset) === null || _window$document$docu === void 0 ? void 0 : _window$document$docu.darkModeAdvanced;\n      this.matchMedia = window.matchMedia('(prefers-color-scheme: dark)');\n      this.storageItemKey = STORAGE_ITEM;\n      this.callbacks = [];\n      onReady(function () {\n        if (isCustomizePreview() || isLoggedIn()) {\n          localStorage.removeItem(TEMP_STORAGE_ITEM);\n          _this.storageItemKey = TEMP_STORAGE_ITEM;\n        }\n\n        _this.initializeCustomizePreview();\n\n        _this.bindEvents();\n\n        _this.update();\n      });\n    }\n  }, {\n    key: \"initializeCustomizePreview\",\n    value: function initializeCustomizePreview() {\n      var _window$wp,\n          _window$parent,\n          _window$parent$wp,\n          _this2 = this;\n\n      var api = ((_window$wp = window.wp) === null || _window$wp === void 0 ? void 0 : _window$wp.customize) || ((_window$parent = window.parent) === null || _window$parent === void 0 ? void 0 : (_window$parent$wp = _window$parent.wp) === null || _window$parent$wp === void 0 ? void 0 : _window$parent$wp.customize);\n\n      if (!api) {\n        return;\n      }\n\n      api('sm_dark_mode_advanced', function (setting) {\n        setting.bind(function (newValue) {\n          _this2.darkModeSetting = newValue;\n          localStorage.removeItem(TEMP_STORAGE_ITEM);\n\n          _this2.update();\n        });\n      });\n    }\n  }, {\n    key: \"bindEvents\",\n    value: function bindEvents() {\n      var _this3 = this;\n\n      var toggles = window.document.querySelectorAll(COLOR_SCHEME_BUTTON_SELECTOR);\n      toggles.forEach(function (toggle) {\n        toggle.addEventListener('click', _this3.onClick.bind(_this3));\n      });\n      this.matchMedia.addEventListener('change', function () {\n        localStorage.removeItem(TEMP_STORAGE_ITEM);\n\n        _this3.update();\n      });\n    }\n  }, {\n    key: \"bind\",\n    value: function bind(callback) {\n      var index = this.callbacks.indexOf(callback);\n\n      if (typeof callback !== \"function\") {\n        return;\n      }\n\n      if (index === -1) {\n        this.callbacks.push(callback);\n      }\n    }\n  }, {\n    key: \"unbind\",\n    value: function unbind(callback) {\n      var index = this.callbacks.indexOf(callback);\n\n      if (index > -1) {\n        this.callbacks.splice(index, 1);\n      }\n    }\n  }, {\n    key: \"onClick\",\n    value: function onClick(event) {\n      event.preventDefault();\n      localStorage.setItem(this.storageItemKey, !!this.isCompiledDark() ? 'light' : 'dark');\n      this.update();\n    }\n  }, {\n    key: \"isSystemDark\",\n    value: function isSystemDark() {\n      var isDark = this.darkModeSetting === 'on';\n\n      if (this.darkModeSetting === 'auto' && this.matchMedia.matches) {\n        isDark = true;\n      }\n\n      return isDark;\n    }\n  }, {\n    key: \"isCompiledDark\",\n    value: function isCompiledDark() {\n      var isDark = this.isSystemDark();\n      var colorSchemeStorageValue = localStorage.getItem(this.storageItemKey);\n\n      if (colorSchemeStorageValue !== null) {\n        isDark = colorSchemeStorageValue === 'dark';\n      }\n\n      return isDark;\n    }\n  }, {\n    key: \"update\",\n    value: function update() {\n      var isDark = this.isCompiledDark();\n      this.callbacks.forEach(function (callback) {\n        callback(isDark);\n      });\n\n      if (isDark) {\n        window.document.documentElement.classList.add('is-dark');\n      } else {\n        window.document.documentElement.classList.remove('is-dark');\n      }\n    }\n  }]);\n\n  return DarkMode;\n}();\n\nfunction onReady(fn) {\n  if (document.readyState != 'loading') {\n    fn();\n  } else {\n    document.addEventListener('DOMContentLoaded', fn);\n  }\n}\n\nfunction inIframe() {\n  try {\n    return window.self !== window.top;\n  } catch (e) {\n    return true;\n  }\n}\n\nfunction isLoggedIn() {\n  return window.document.body.classList.contains('logged-in');\n}\n\nfunction isCustomizePreview() {\n  var _window, _window$parent2, _window$parent2$wp;\n\n  return inIframe() && ((_window = window) === null || _window === void 0 ? void 0 : (_window$parent2 = _window.parent) === null || _window$parent2 === void 0 ? void 0 : (_window$parent2$wp = _window$parent2.wp) === null || _window$parent2$wp === void 0 ? void 0 : _window$parent2$wp.customize);\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (new DarkMode());\n\n//# sourceURL=webpack://sm.%5Bname%5D/./src/_js/dark-mode/index.js?")},jquery:function(n){n.exports=window.jQuery}},__webpack_module_cache__={};function __webpack_require__(n){var e=__webpack_module_cache__[n];if(void 0!==e)return e.exports;var t=__webpack_module_cache__[n]={exports:{}};return __webpack_modules__[n](t,t.exports,__webpack_require__),t.exports}__webpack_require__.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return __webpack_require__.d(e,{a:e}),e},__webpack_require__.d=function(n,e){for(var t in e)__webpack_require__.o(e,t)&&!__webpack_require__.o(n,t)&&Object.defineProperty(n,t,{enumerable:!0,get:e[t]})},__webpack_require__.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},__webpack_require__.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})};var __webpack_exports__=__webpack_require__("./src/_js/dark-mode/index.js");(window.sm=window.sm||{}).darkMode=__webpack_exports__})();