(()=>{importScripts("../../vendor_js/chroma.min.js"),addEventListener("message",(function(t){var r=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;return n.k(r),n.iterations(e),n.data(t),n.clusters()}(function(n,t,r){var e,i,o,a=[],u=4,c=0;for(e=0,i=n.length;e<i;e+=u){if(0!==(o=n.slice(e,e+u))[3]){var l=chroma([o[0],o[1],o[2]]),f=l.lab();l.luminance()>.05&&a.push(f)}c<t-1?c+=1:(c=0,1)}return a}(t.data.imageData),5,10);r.sort((function(n,t){return n.points.length>t.points.length?-1:n.points.length<t.points.length?1:0})),r.splice(3);var e,i,o=r.map((function(n){return chroma(n.centroid,"lab").rgb()}));e="Palette",i=o,self.postMessage({type:"palette",label:e,colors:i})}));var n={data:e([],(function(n){var t=n[0].length;return n.map((function(n){return n.length===t})).reduce((function(n,t){return n&t}),!0)})),clusters:function(){var n=function(n,e){for(var i=e.k||Math.round(Math.sqrt(n.length/2)),o=e.iterations,a=n.map((function(n){return new t(n)})),u=[],c=0;c<i;c++)u.push(new r(a[c%a.length].location(),c));for(var l=0;l<o;l++)a.forEach((function(n){n.updateLabel(u)})),u.forEach((function(n){n.updateLocation(a)}));return{points:a,centroids:u}}(this.data(),{k:this.k(),iterations:this.iterations()}),e=n.points;return n.centroids.map((function(n){return{centroid:n.location(),points:e.filter((function(t){return t.label()===n.label()})).map((function(n){return n.location()}))}}))},k:e(void 0,(function(n){return n%1==0&n>0})),iterations:e(Math.pow(10,3),(function(n){return n%1==0&n>0}))};function t(n){var t=this;this.location=e(n),this.label=e(),this.updateLabel=function(n){var r,e,i=n.map((function(n){return r=t.location(),e=n.location(),r.map((function(n,t){return Math.pow(n-e[t],2)})).reduce((function(n,t){return n+t}),0);var r,e}));t.label((e=(r=i).reduce((function(n,t){return Math.min(n,t)})),r.indexOf(e)))}}function r(n,t){var r=this;this.location=e(n),this.label=e(t),this.updateLocation=function(n){var t=n.filter((function(n){return n.label()===r.label()}));t.length>0&&r.location(function(n){var t=n[0].location().map((function(){return 0}));return n.map((function(n){return n.location()})).reduce((function(n,t){return function(n,t){return n.map((function(n,r){return n+t[r]}))}(n,t)}),t).map((function(t){return t/n.length}))}(t))}}function e(n,t){var r=n,e=t||function(n){return!0};return function(n){if(void 0===n)return r;e(n)&&(r=n)}}})();